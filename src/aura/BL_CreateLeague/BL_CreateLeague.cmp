<aura:component description="BL_CreateLeague" controller="BL_CreateLeagueController">

    <aura:attribute name="initDataWrapper" type="Object" access="private"/>
    <aura:attribute name="newLeagueWrapper" type="Object" default="{}" access="private"/>
    <aura:attribute name="cupTeamsNumber" type="List" default="[4,8,16,32,64]" access="private"/>

    <aura:attribute name="simpleNewLeague" type="Object"/>
    <aura:attribute name="newLeagueError" type="String"/>
    <aura:attribute name="maxTeamsOptions" type="String[]"/>
    <aura:attribute name="selectedMaxTeamOption" type="String"/>
    <aura:attribute name="endDateInputVisible" type="Boolean" default="false"/>
    <aura:attribute name="currentDate" type="String"/>
    <aura:attribute name="yearLaterDate" type="String"/>
    <aura:attribute name="maxEndDate" type="String"/>
    <aura:attribute name="isNumberOfTeamsUnlimited" type="Boolean" default="false"/>
    <aura:attribute name="isFormVisible" type="Boolean" default="true"/>
    <aura:attribute name="leagueRoundsNumber" type="List" default="[]" access="private"/>
    <aura:attribute name="totalMatches" type="Integer" default="0" access="private"/>
    <aura:attribute name="totalMatchesLimit" type="Integer" default="800"/>
    <aura:attribute name="totalRoundsLimit" type="Integer" default="20"/>

    <aura:handler name="init" value="{!this}" action="{!c.onInit}"/>
    <aura:handler name="change" value="{!v.simpleNewLeague.Start_Date__c}" action="{!c.handleStartDateChange}"/>

    <aura:registerEvent name="competitionCreated" type="c:BL_CompetitionCreatedEvent"/>

    <force:recordData aura:id="leagueRecordCreator"
                      layoutType="FULL"
                      targetRecord="{!v.newLeague}"
                      targetFields="{!v.simpleNewLeague}"
                      targetError="{!v.newLeagueError}"/>

    <aura:if isTrue="{!not(empty(v.initDataWrapper))}">
        <div class="slds-align_absolute-center">
            <lightning:layout multipleRows="true" class="new-league-form">
                <lightning:layoutItem
                        size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="6"
                        class="slds-p-around--x-small"
                >
                    <lightning:radioGroup
                            label="Type"
                            options="{!v.initDataWrapper.leagueRecordTypeOptions}"
                            value="{!v.newLeagueWrapper.recordType}"
                            type="button"
                            onchange="{!c.onLeagueRecordTypeChange}"
                            required="true"
                    />
                </lightning:layoutItem>
                <lightning:layoutItem
                        size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="6"
                        class="slds-p-around--x-small"
                >
                    <lightning:radioGroup
                            label="Team size"
                            options="{!v.initDataWrapper.leagueTeamSizeOptions}"
                            value="{!v.newLeagueWrapper.teamSize}"
                            type="button"
                            required="true"
                    />
                </lightning:layoutItem>
                <lightning:layoutItem size="12" class="slds-p-around--x-small">
                    <lightning:input
                            label="Name"
                            value="{!v.newLeagueWrapper.name}"
                            pattern="[a-zA-Z0-9ąćęłńóśźżĄĆĘŁŃÓŚŹŻ &amp;!@#$%^*()]+"
                            maxlength="40"
                            required="true"
                            messageWhenPatternMismatch="Only letters and numbers allowed"
                    />
                </lightning:layoutItem>
                <lightning:layoutItem
                        size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="6"
                        class="slds-p-around--x-small">
                    <lightning:input
                            label="Start Date"
                            value="{!v.newLeagueWrapper.startDate}"
                            type="datetime"
                            required="true"
                            min="{!v.currentDate}"
                    />
                </lightning:layoutItem>
                <lightning:layoutItem
                        size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="6"
                        class="slds-p-around--x-small"
                >
                    <lightning:input
                            label="End Date"
                            value="{!v.newLeagueWrapper.endDate}"
                            type="datetime"
                            required="true"
                            min="{!v.newLeagueWrapper.startDate}"
                            disabled="{!empty(v.newLeagueWrapper.startDate)}"
                    />
                </lightning:layoutItem>
                <aura:if isTrue="{!or(equals(v.newLeagueWrapper.recordType, 'Classic'), equals(v.newLeagueWrapper.recordType, 'Battle_Royale'))}">
                    <lightning:layoutItem
                            size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="6"
                            class="slds-p-around--x-small"
                    >
                        <lightning:input
                                label="Teams limit (2-40)"
                                value="{!v.newLeagueWrapper.teamsLimit}"
                                type="number"
                                min="2"
                                max="40"
                                required="true"
                        />
                    </lightning:layoutItem>
                </aura:if>
                <aura:if isTrue="{!equals(v.newLeagueWrapper.recordType, 'Cup')}">
                    <lightning:layoutItem
                            size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="6"
                            class="slds-p-around--x-small"
                    >
                        <lightning:select
                                label="Teams"
                                value="{!v.newLeagueWrapper.teamsLimit}"
                                required="true"
                        >
                            <aura:iteration items="{!v.cupTeamsNumber}" var="cupTeamsLimit">
                                <option label="{!cupTeamsLimit}" value="{!cupTeamsLimit}"></option>
                            </aura:iteration>
                        </lightning:select>
                    </lightning:layoutItem>
                </aura:if>
                <aura:if isTrue="{!or(equals(v.newLeagueWrapper.recordType, 'Classic'), equals(v.newLeagueWrapper.recordType, 'Battle_Royale'))}">
                    <lightning:layoutItem
                            size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="6"
                            class="slds-p-around--x-small"
                    >
                        <lightning:input
                                label="Rounds"
                                value="{!v.newLeagueWrapper.rounds}"
                                type="number"
                                min="2"
                                max="40"
                                required="true"
                        />
                    </lightning:layoutItem>
                </aura:if>
                <lightning:layoutItem size="12" class="slds-p-around--x-small slds-align--absolute-center">
                    <lightning:button label="Create"
                                      variant="brand"
                                      onclick="{!c.onSave}"
                    />
                </lightning:layoutItem>
            </lightning:layout>
        </div>
    </aura:if>
</aura:component>